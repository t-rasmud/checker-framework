\htmlhr
\chapterAndLabel{Checksum Checker}{checksum-checker}

The Checksum Checker ensures that all data that passes from labelled sources
to labelled sinks are correctly protected by checksums.
A labelled source could be a method in a library that computes checksums.
A labelled source could be a method in a library that accesses checksummed data.

If an expression \<D>'s type has the type qualifier
\<\refqualclass{checker/checksum/qual}{ChecksummedBy}{\small("\emph{checksumexpr}")}>,
then \<\small\emph{checksumexpr}> holds \<D>'s checksum

As an illustration, consider the following annotated method signature:
\begin{Verbatim}
    void myMethod(@ChecksummedBy("#2") int data, int cs) { ... }
\end{Verbatim}
The programmer has indicated that the first argument (\<data>) of a call to
\<myMethod> must be checksummed by the second argument (\<cs>).
Given the above annotation on \<myMethod>, the Checksum Checker verifies that at
every call to \<myMethod>, the second argument is a checksum for the first argument.

The only legal operations on a \<@ChecksummedBy> type are performed by the
checksum libarary.  It is illegal to perform other operations (e.g.,
addition, string concatenation, etc.) on a \<@ChecksummedBy> type.
A user must first use the checksum library to validate the checksum, then
can use the data.

To run the Checksum Checker, supply the
\code{-processor org.checkerframework.checker.checksum.ChecksumChecker}
command-line option to javac.

\sectionAndLabel{Checksum annotations}{checksum-annotations}

This section describes the checksum annotations you can write on a type.

\subsectionAndLabel{Type qualifiers}{checksum-type-qualifiers}

\begin{description}

    \item[\refqualclass{checker/checksum/qual}{NotChecksummed}]
    A type having the qualifier \<@NotChecksummed> represents values that are not checksummed.
    This is the default type qualifier;  programmers do not need to write it.

    \item[\refqualclass{checker/checksum/qual}{ChecksummedBy}]
    A type having the qualifier \<@ChecksummedBy> represents values that are checksummed.
    This is unrelated to \<@NotChecksummed> in the type hierarchy,
    and \<@ChecksummedBy{\small("\emph{a}")}> is unrelated to
    \<@ChecksummedBy{\small("\emph{b}")}>.

    \item[\refqualclass{checker/checksum/qual}{UnknownChecksum}]
    A type having the qualifier \<@UnknownChecksum> represents values
    that might or might not be protected by checksums.
    A type annotated with this qualifier cannot be used where
    \<@NotChecksummed> is expected, and it cannot be used where
    \<@ChecksummedBy> is expected. Programmers should never write it.
    It generally indicates a programming error or unnecessarily complex code.

    \item[\refqualclass{checker/checksum/qual}{ChecksumBottom}]
    This is the bottom type qualifier. It is used only for the null value.
    Programmers should not write it (except in rare cases in wildcard types).

    \item[\refqualclass{checker/checksum/qual}{PolyChecksum}]
    This is the polymorphic qualifier for the Checksum type system.

\end{description}

\begin{figure}
    \includeimage{checksum-hierarchy}{6cm}
    \caption{The subtyping relationship of the Checksum Checker's qualifiers.}
    \label{fig-checksum-hierarchy}
\end{figure}

Figure~\ref{fig-checksum-hierarchy} shows the type hierarchy of these
qualifiers.

\sectionAndLabel{Fields and intrinsic checksums}{intrinsic-checksums}
An extrinsic checksum is stored in addition to the data, as when two variables
\<int data> and \<int checksum> are passed to a routine.  An intrinsic checksum is part of the data,
as when a class contains some fields and a checksum field.  For intrinsic checksums, the annotation
\<@ChecksummedBy> appears on fields.  Mentions of the object type do not need any annotations.

When one field of an object is checksummed by another field, it is annotated as shown in the following example:

\begin{Verbatim}
    class C {
        int field1;
        @ChecksummedBy("cs2") int field2;
        int field3;
        @ChecksummedBy("cs4") int field4;
        int cs2;  // checksum for field2
        int cs4;  // checksum for field4
    }
\end{Verbatim}

